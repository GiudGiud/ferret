# MasterExchangeCartLLG

!syntax description /Kernels/MasterExchangeCartLLG

## Overview

We consider the effective field $\mathbf{H}_\mathrm{exch}$ generated by the variational derivative of the exchange stiffness energy density $f_\mathrm{exch}$,

\begin{equation}
  \begin{aligned}
    f_\mathrm{exch} &= \frac{A_e}{M_s^2} \left\{\left|\nabla M_x\right|^2 + \left|\nabla M_y\right|^2 + \left|\nabla M_z\right|^2 \right\}
  \end{aligned}
\end{equation}

where $\mathbf{M}$ is the magnetization and $M_s$ the saturation magnetization. Since,

\begin{equation}
  \begin{aligned}
    |\nabla f|^2 = \nabla \cdot \left(f\nabla f\right) - f \nabla^2 f,
  \end{aligned}
\end{equation}

we can write the above expression as

\begin{equation}
  \begin{aligned}
    f_\mathrm{exch} &= - A_e \mathbf{m} \cdot \nabla^2 \mathbf{m}
  \end{aligned}
\end{equation}

with $\mathbf{m}$ the normalized magnetization. The effective field $\mathbf{H}_\mathrm{exch}$ is

\begin{equation}
  \begin{aligned}
    \mathbf{H}_\mathrm{exch} &= -\frac{1}{\mu_0} \frac{\delta f_\mathrm{exch}}{\delta \mathbf{m}} \\
    &= \frac{2 A_e}{\mu_0} \nabla^2 \mathbf{m}.
  \end{aligned}
\end{equation}

The LLG equation for the normalized magnetization is,

\begin{equation}\label{LLG}
  \begin{aligned}
    \frac{\partial \mathbf{m}}{\partial t} = -\gamma \mathbf{m}\times \mathbf{H} - \frac{\gamma \alpha}{1+\alpha^2} \mathbf{m} \times \mathbf{m}\times \mathbf{H},
  \end{aligned}
\end{equation}

with $\gamma$ the gyromagnetic ratio. Multiplying by a test function $\psi_h$, moving over the RHS, neglecting the time derivative, and integrating over the volume, we have,

\begin{equation}
  \begin{aligned}
    \gamma\left(\psi_h, \mathbf{m}\times \mathbf{H}\right) + \frac{\gamma \alpha}{1+\alpha^2} \left(\psi_h, \mathbf{m} \times \mathbf{m}\times \mathbf{H}\right) = 0
  \end{aligned}
\end{equation}

This equation in index notation is,

\begin{equation}
  \begin{aligned}
    \gamma \left(\psi_h, \epsilon_{ijk} m_i H_j \right) + \frac{\gamma \alpha}{1+\alpha^2}\left(\psi_h, \epsilon_{ijk} \epsilon_{rsj} m_i m_r H_s \right) = 0
  \end{aligned}
\end{equation}

with $\epsilon_{ijk}$ the Levi-Civita symbol. Inserting the expression for the effective field due to the exchange stiffness, we have

\begin{equation}
  \begin{aligned}
    2\gamma_\mathrm{H} A_e \left(\psi_h, \epsilon_{ijk} m_i \frac{\partial^2 m_j}{\partial x_\eta x_\eta} \right) + 2\frac{\gamma_\mathrm{H} \alpha A_e}{1+\alpha^2} \left(\psi_h, \epsilon_{ijk} \epsilon_{rsj} m_i m_r \frac{\partial^2 m_s}{\partial x_\eta x_\eta} \right) = 0
  \end{aligned}
\end{equation}

Now integrating by parts we obtain,

\begin{equation}
  \begin{aligned}
    -2\gamma_\mathrm{H} A_e \left(\frac{\partial\psi_h}{\partial x_\eta}, \epsilon_{ijk} m_i \frac{\partial m_j}{\partial x_\eta} \right) + 2\gamma_\mathrm{H} A_e \left\langle \psi_h, \epsilon_{ijk} m_i \frac{\partial m_j}{\partial x_\eta} \right\rangle - \frac{2\gamma_\mathrm{H} \alpha A_e}{1+\alpha^2} \left(\frac{\partial \psi_h}{\partial x_\eta},  \epsilon_{ijk} \epsilon_{rsj} m_i m_r \frac{\partial m_s}{\partial x_\eta} \right) + \frac{2\gamma_\mathrm{H} \alpha A_e}{1+\alpha^2} \left\langle \frac{\psi_h}{\partial x_\eta}, \epsilon_{ijk} \epsilon_{rsj} m_i m_r \frac{\partial m_s}{\partial x_\eta} \right\rangle = 0
  \end{aligned}
\end{equation}

The surface terms $\langle ,\rangle$ vanish due to the properties of $\psi_h$ and we are left with the residual contribution to $m_k$ due to the exchange,

\begin{equation}
  \begin{aligned}
    \mathcal{R}_{m_k} = -2 \gamma_\mathrm{H} A_e \left(\frac{\partial\psi_h}{\partial x_\eta},  \epsilon_{ijk} m_i \frac{\partial m_j}{\partial x_\eta} \right) - \frac{2\gamma_\mathrm{H} \alpha A_e}{1+\alpha^2}\left(\frac{\partial \psi_h}{\partial x_\eta}, \epsilon_{ijk} \epsilon_{rsj} m_i m_r \frac{\partial m_s}{\partial x_\eta} \right)
  \end{aligned}
\end{equation}

The on-diagonal $(\beta = k)$ and off-diagonal $(\beta \neq k)$ jacobian contributions are calculated with,

\begin{equation}
  \begin{aligned}
    \mathcal{J}_{m_k, m_\beta} = \frac{\partial \mathcal{R}_{m_k}}{\partial m_\gamma} &= - 2\gamma_\mathrm{H} A_e\frac{\partial}{\partial m_\beta}\left(\frac{\partial\psi_h}{\partial x_\eta}, \epsilon_{ijk} m_i \frac{\partial m_j}{\partial x_\eta} \right) - \frac{2\gamma_\mathrm{H} \alpha A_e}{1+\alpha^2} \frac{\partial}{\partial m_\beta}\left(\frac{\partial \psi_h}{\partial x_\eta}, \epsilon_{ijk} \epsilon_{rsj} m_i m_r \frac{\partial m_s}{\partial x_\eta} \right) \\
    &= -2\gamma_\mathrm{H} A_e \left(\frac{\partial\psi_h}{\partial x_\eta}, \epsilon_{\beta jk} \phi \frac{\partial m_j}{\partial x_\eta} \right) -2\gamma_\mathrm{H} A_e \left(\frac{\partial\psi_h}{\partial x_\eta}, \epsilon_{i\beta k} m_i \frac{\partial \phi}{\partial x_\eta} \right) - \frac{2\gamma_\mathrm{H} \alpha A_e}{1+\alpha^2}  \left(\frac{\partial \psi_h}{\partial x_\eta}, \epsilon_{\beta jk} \epsilon_{rsj} m_r \frac{\partial m_s}{\partial x_\eta} \right) - \frac{2\gamma_\mathrm{H} \alpha A_e}{1+\alpha^2}  \left(\frac{\partial \psi_h}{\partial x_\eta}, \epsilon_{ijk} \epsilon_{\beta sj} m_i \frac{\partial m_s}{\partial x_\eta} \right)  - \frac{2\gamma_\mathrm{H} \alpha A_e}{1+\alpha^2}  \left(\frac{\partial \psi_h}{\partial x_\eta}, \epsilon_{ijk} \epsilon_{r\beta j} m_i m_r \frac{\partial \phi}{\partial x_\eta} \right),
  \end{aligned}
\end{equation}

using $\partial m_j / \partial m_\beta = \delta_{j\beta} \phi$ and $\partial^2 m_j / \partial m_\beta \partial x_\eta = \delta_{j\beta} \partial \phi / \partial x_\eta$ where $\phi$ is the shape function of the finite element method. Note that $A_e$ can be treated as a spatially dependent materials property. This means that the volume integrals will be taken over $A_e(\mathbf{x})$ and this parameter should be moved inside $(,)$ in the above expressions.

## Example Input File Syntax

!! Describe and include an example of how to use the MasterExchangeCartLLG object.

!syntax parameters /Kernels/MasterExchangeCartLLG

!syntax inputs /Kernels/MasterExchangeCartLLG

!syntax children /Kernels/MasterExchangeCartLLG
